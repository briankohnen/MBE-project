<!DOCTYPE html>
<html>
<head>
   <meta charset='utf-8'>
   <meta http-equiv='X-UA-Compatible' content='IE=edge'>
   <title>Page Title</title>
   <meta name='viewport' content='width=device-width, initial-scale=1'>
   <link rel='stylesheet' type='text/css' media='screen' href='assets/css/style.css'>
   <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>

   <h1>Find Events Near You</h1>

   <form class="searchBar">
       <input type="text" placeholder="Search..." name="search2" id="userInput">
       <button type="submit" id="submitButton">submit</button>
     </form>

     <div class='gridContainer'>

      <div class="eventContainer">
        <ul id="eventsList">
        </ul>
      </div>

      <div class="mapPlacement" id="map"></div>

    </div>

    <script>

    var myLat = 0;
    var myLong = 0;

         navigator.geolocation.getCurrentPosition(function(position) {
        myLat = position.coords.latitude;
        myLong = position.coords.longitude;

        var map = new ol.Map({
          target: 'map',
          layers: [
            new ol.layer.Tile({
              source: new ol.source.OSM()
            })
          ],
          view: new ol.View({
            center: ol.proj.fromLonLat([myLong, myLat]),
            zoom: 18
          })
        });

          console.log(myLat, myLong);
      });

      $("#submitButton").on("click", function() {

        var userInput;

    event.preventDefault();

    userInput = $("#userInput").val().trim();

    console.log(userInput);

    var queryURL = //"https://app.ticketmaster.com/discovery/v2/events.json?keyword=music&postalCode=60640&apikey=7elxdku9GGG5k8j0Xm8KWdANDgecHMV0"
    //"https://app.ticketmaster.com/discovery/v2/events.json?keyword=music&latlong=" + myLat + myLong + "&apikey=7elxdku9GGG5k8j0Xm8KWdANDgecHMV0";
    "https://app.ticketmaster.com/discovery/v2/events.json?keyword=music&city=" + userInput.toString() + "&apikey=7elxdku9GGG5k8j0Xm8KWdANDgecHMV0"


      $.ajax({

      url: queryURL,    

      method: "GET"

    }).then(function(response) {

        var results = response._embedded.events;
        console.log(results);

        for (var i = 0; i < results.length; i++) {

          var eventName = results[i].name;
          var eventLocation = results[i]._embedded.venues[0].address.line1;
          var eventCoords = [results[i]._embedded.venues[0].location.longitude, results[i]._embedded.venues[0].location.latitude];
          var eventDate = results[i].dates.start.localDate;
          var eventTime = results[i].dates.start.localTime;
          var eventLink = results[i].url;
          var linkForUser = $("<a>Click here to buy tickets</a>");
          linkForUser.attr("href", eventLink);

          var eventLI = $("<li>");
          eventLI.attr("class", "eventNearMe");
          eventLI.attr("data-attr", i);
          eventLI.append(eventName, "<br>", eventLocation, "<br>", eventDate, "<br>", eventTime, "<br>", linkForUser);

          $("#eventsList").append(eventLI);
        }

      });





    });

  //});
        </script>

<!-- <script src='app.js'></script> -->

</body>
</html>